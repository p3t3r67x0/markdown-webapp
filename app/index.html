<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>Markdown Converter v0.0.12</title>
  <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.3.5/dist/alpine.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
  <style media="screen">
    .bg-custom-400 {
      background: #AAFFA9;
      background: -webkit-linear-gradient(#11FFBD, #AAFFA9);
      background: linear-gradient(#11FFBD, #AAFFA9);
    }

    .bg-custom-500 {
      background-color: #f56801;
    }
  </style>
</head>

<body class="bg-gray-700 relative">
  <div class="absolute w-full">
    <h1 class="absolute w-full text-6xl font-bold text-white px-6">reedo.me</h1>
    <svg class="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 350 1440 657">
      <defs>
        <path d="M0 892.505c308.829 32.498 548.829 7.536 720-74.885 171.171-82.422 411.171-104.978 720-67.668V0H0v892.505z" id="a" />
      </defs>
      <g>
        <path d="M-55.431 836.955c336.93 43.08 603.018 15.377 798.265-83.11 195.246-98.486 461.131-123.26 797.655-74.317l37.318-537.237L-6.05 126.037l-49.382 710.92z" fill="#E8F4FD" />
        <use fill="#018EF5" xlink:href="#a" transform="translate(0 -94)" />
      </g>
    </svg>
  </div>

  <div x-data="bindForm()" class="relative h-screen z-50 px-4">
    <div class="flex flex-col items-center justify-center min-h-full">
      <div class="max-w-5xl w-full p-4 bg-gray-300 rounded-lg">
        <h1 class="inline-block text-6xl bg-custom-500 font-bold text-white px-3 mb-4">README.md to PDF</h1>
        <p class="text-xl text-gray-800 mb-8">Your markdown Converter let's you convert any README.md to PDF with just a button click, try it!</p>
        <div class="mb-4">
          <label for="format" class="block text-lg text-gray-800 font-bold mb-2">Choose format</label>
          <div class="relative">
            <select v-model="settings.amenity" class="appearance-none cursor-pointer focus:outline-none block w-full px-2 py-2 rounded border border-gray-500 text-lg">
              <option value="gfm" selected>Github Markdown</option>
              <option value="md">Markdown</option>
              <option value="rst">reStructured Text</option>
            </select>
            <div class="pointer-events-none cursor-pointer absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
              <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
              </svg>
            </div>
          </div>
        </div>
        <div class="mb-6">
          <label for="format" class="block text-lg text-gray-800 font-bold mb-2">Source address</label>
          <input type="text" x-model="input" placeholder="https://github.com/user/repo" class="w-full px-2 py-2 rounded border border-gray-500 text-lg" />
        </div>
        <div class="text-right">
          <button type="button" @click="startConverter()" class="text-gray-900 bg-custom-400 rounded shadow px-3 py-2">Convert now</button>
        </div>
      </div>
    </div>
    <div id="output" class="container text-white"></div>
  </div>
</body>

<script>
  const scheme = window.location.protocol;
  const host = window.location.host;
  const url = scheme + "//api." + host;

  const socket = io.connect(url);

  socket.emit('loaded');

  socket.on('my_response', function(data) {
    let outputDiv = document.getElementById('output');
    let contentDiv = document.createElement('div');
    contentDiv.innerHTML = '<pre class="break-all">' + data.data + '</pre>';

    while (contentDiv.firstChild) {
      outputDiv.appendChild(contentDiv.firstChild);
    }
  });

  socket.on('done', function() {
    const format = document.getElementById('format');
    const input = document.getElementById('input');

    fetch(url + '/retrieve', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          format: format,
          input: input
        })
      })
      .then(res => res.blob())
      .then(data => {
        download(data);
      }).catch(err => {
        console.error('error log message ', err);
      });
  });

  function download(data) {
    const file = new Blob([data], {
      type: 'application/pdf'
    });

    // process to auto download it
    const fileURL = URL.createObjectURL(file);
    const link = document.createElement('a');
    link.href = fileURL;
    link.download = 'out.pdf';
    link.click();
    link.remove();
  }

  function bindForm() {
    return {
      input: null,
      format: 'gfm',
      startConverter() {
        document.getElementById('output').innerHTML = '';
        socket.emit('instance', this.format, this.input);
      }
    }
  }
</script>

</html>
